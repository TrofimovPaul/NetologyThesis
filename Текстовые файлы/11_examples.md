
# Примеры

Для сравнения оцениваемых моделей было решено протестировать их на данных из датасета "example.csv", собранного из
данных исходного датасета с переработанной фильтрацией.  
Использовался скрипт для получения датафрейма с первой колонкой включающей лемматизированный текст, со второй колонкой,
включающей правильные номера категорий/тегов, с остальными колонками, включающими в себя предсказания от каждой модели
для лемматизированного текста из первой колонки.

```python
df_ex = pd.read_csv('example.csv')
df_ex.fillna(0, inplace = True)
columns_lst = df_ex.columns[1:]
df_final_example = df_ex.drop(columns=columns_lst)

models_list_comparison = ['ai-forever-rubert-base.pt',
 'cointegrated-rubert-tiny2_14.pt',
 'FacebookAI-xlm-roberta-base_10.pt',
 'Geotrend-distilbert-base-ru-cased_12.pt',
 'model_tfidf_catboost_ngram_1_1.pkl',
 'model_tfidf_logreg_ngram_1_1.pkl',
 'model_tfidf_logreg_ngram_1_2.pkl']

for k in models_list_comparison:
    print(k[:-3])
    try:
        df_pred = pd.read_csv('df_pred_' + k[:-3] + '.csv')
    except:
        df_pred = pd.read_csv('df_pred_' + k[6:-4] + '.csv')
    indices_pred_list = []
    indices_true_list = []
    for elem in range(len(df_pred)):
        indices_pred = set(np.where(df_pred.to_numpy()[elem])[0])
        indices_true = set(np.where(df_ex[columns_lst].to_numpy()[elem])[0])
        indices_pred_list.append(indices_pred)
        indices_true_list.append(indices_true)
    df_final_example[f'id_true_{k[:-3]}'] = indices_true_list
    df_final_example[f'id_pred_{k[:-3]}'] = indices_pred_list
columns_final_ex = df_final_example.columns
```

Также использовалась формула comparison_result для вывода результатов предсказаний по одному лемматизированному тексту для
разных моделей

```python
def comparison_result(st_ind,end_ind,columns_lst, columns_final_ex):
    for col in range(1,15,2):
        #    print(col)
        st_col, end_col = columns_final_ex[col], columns_final_ex[col+1]
        print(st_col, end_col)
        for i in range(len(df_final_example[st_ind:end_ind].loc[:,['text_lemma',st_col,end_col]])):
            text_lemm = df_final_example[st_ind:end_ind].loc[:,['text_lemma',st_col,end_col]].iloc[i][0]
            true_tag = columns_lst[list(df_final_example[st_ind:end_ind].loc[:,['text_lemma',st_col,end_col]].iloc[i][1])[0]]
            print('model:', st_col[8:])
            print('text_lemmatize:', text_lemm)
            print('true_tag:', true_tag)
            try:
                pred_tag = list(df_final_example[st_ind:end_ind].loc[:,['text_lemma',st_col,end_col]].iloc[i][2])
                list_pred = []
                for tag in pred_tag:
                    list_pred.append(columns_lst[tag])
                print('pred_tag:',', '.join(list_pred))
            except:
                pred_tag = ''
                print('pred_tag:', pred_tag)
            print()

comparison_result(170,171,columns_lst, columns_final_ex)
# вывод переработан для сокращения
>>>
'''
Президент России Владимир Путин своим указом произвел в генералы 33 полковника различных ведомств — от Министерства обороны до Военной прокуратуры. Соответствующий указ в среду, 12 декабря, опубликован на официальном портале правовой информации. Кроме того, еще 16 генералам присвоены очередные воинские звания. В частности, в Минобороны России появился один новый генерал-полковник и один полный адмирал, восемь генерал-лейтенантов и два приравненных к ним вице-адмирала, 10 генерал-майоров и один контр-адмирал. В МЧС появиллось два генерал-полковника, четыре генерал-лейтенанта и семь генерал-майоров. В свою очередь, Росгвардия пополнилась одним генерал-полковником, тремя генерал-лейтенантами и девятью генерал-майорами. В Военной прокуратуре появился один генерал-лейтенант юстиции и три генерал-майора. Наконец, Федеральная служба исполнения наказаний (ФСИН) получила двух генерал-лейтенантов и четырех генерал-майоров. Так, генерал-лейтенант Евгений Устинов, командующий войсками Центрального военного округа стал генерал-полковником, а командующий Балтийским флотом вице-адмирал Александр Носатов отныне — полный адмирал. Командующий Уральским округом Росгвардии генерал-лейтенант Александр Попов получил на погоны третью шитую звезду и стал генерал-полковником. В основном генеральские звания присвоены офицерам, чей «потолок по должности» с недавнего времени увеличен — в течение ноября-декабря президент внес изменения в положения почти о всех силовых структурах, увеличив число генеральских должностей.
'''

text_lemmatize: президент россия владимир путин свой указ производить генерал полковник различный ведомство министерство оборона военный прокуратура соответствующий указ среда декабрь опубликовывать официальный портал правовой информация кроме генерал присваивать очередной воинский звание частность минобороны россия появляться новый генерал-полковник полный адмирал восемь генерал-лейтенант приравнивать вице-адмирал генерал-майор контр-адмирал мчс появиллось генерал-полковник четыре генерал-лейтенант семь генерал-майор свой очередь росгвардия пополняться генерал-полковник генерал-лейтенант девять генерал-майор военный прокуратура появляться генерал-лейтенант юстиция генерал-майор федеральный служба исполнение наказание фсин получать генерал-лейтенант четыре генерал-майор генерал-лейтенант евгений устинов командовать войско центральный военный округ становиться генерал-полковник командующий балтийский флот вице-адмирал александр носат отныне полный адмирал командующий уральский округ росгвардия генерал-лейтенант александр попов получать погон третий шитый звезда становиться генерал-полковник основной генеральский звание присваивать офицер чей потолок должность недавний время увеличивать течение ноябрь декабрь президент вносить изменение положение весь силовой структура увеличивать число генеральский должность

model: ai-forever-rubert-base
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы

model: cointegrated-rubert-tiny2_14
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы

model: FacebookAI-xlm-roberta-base_10
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы

model: Geotrend-distilbert-base-ru-cased_12
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы

model: model_tfidf_catboost_ngram_1_1.
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы

model: model_tfidf_logreg_ngram_1_1.
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы, Россия, Оружие

model: model_tfidf_logreg_ngram_1_2.
true_tag: Полиция и спецслужбы
pred_tag: Полиция и спецслужбы, Россия, Общество, Оружие
```

```python
comparison_result(263,264,columns_lst, columns_final_ex)

>>>
'''
Улицу бутиков в «Барвиха Luxury Village» украсили к Новому году по мотивам сказки Гофмана «Щелкунчик и Мышиный Король». Об этом сообщается в пресс-релизе, присланном в редакцию «Ленты.ру» в четверг, 13 декабря. В центре внимания — красавица Мари, главная героиня сказки. Фигура главного положительного героя — Щелкунчика — установлена у праздничной елки возле Barvikha Hotel & Spa, украшенной бутафорскими конфетами, игрушками, бантами и коробками с подарками. Его сказочный антогонист — семиголовый Мышиный Король — венчает стилизованный торте праздничной карусели. Карусель «оккупировала» армия Мышиного короля, охраняющая золотые орехи и бронзовые пушки. Одна из самых романтичных инсталляций — па-де-де, которое танцуют Фея Драже и принц Оршад: их силуэты мягко подсвечены. На улице бутиков звучит музыка из знаменитого балета Петра Ильича Чайковского: барабанный бой, фанфары, дивертисмент, «Вальс цветов» и заключительное лирическое адажио. Ранее в ноябре московский универмаг ЦУМ открыл традиционный рождественский базар. Фасад универмага «перевязали» красными лентами с бантами, а стены украсили рождественскими звездами. В атриуме ЦУМа возвышается десятиметровая новогодняя елка с золотистыми украшениями, а галереи этажей декорированы бантами, разноцветными шарами, звездами и подарочными коробками.
'''

text_lemmatize: улица бутик барвиха luxury village украшать новый год мотив сказка гофман щелкунчик мышиный король это сообщаться пресс-релиз присылать редакция лента ру четверг декабрь центр внимание красавица мари главный героиня сказка фигура главный положительный герой щелкунчик устанавливать праздничный елка возле barvikha hotel spa украшать бутафорский конфета игрушка бант коробка подарок сказочный антогонист семиголовый мышиный король венчать стилизованный торт праздничный карусель карусель оккупировать армия мышиный король охранять золотой орех бронзовый пушка самый романтичный инсталляция па-де-де который танцевать фея драже принц оршад силуэт мягко подсвечивать улица бутик звучать музыка знаменитый балет петр ильич чайковский барабанный бой фанфара дивертисмент вальс цветок заключительный лирический адажио ранее ноябрь московский универмаг цум открывать традиционный рождественский базар фасад универмаг перевязывать красный лента бант стена украшать рождественский звезда атриум цум возвышаться десятиметровый новогодний елка золотистый украшение галерея этаж декорировать бант разноцветный шар звезда подарочный коробка

model: ai-forever-rubert-base
true_tag: Явления
pred_tag: Явления

model: cointegrated-rubert-tiny2_14
true_tag: Явления
pred_tag: Явления

model: FacebookAI-xlm-roberta-base_10
true_tag: Явления
pred_tag: Инструменты

model: Geotrend-distilbert-base-ru-cased_12
true_tag: Явления
pred_tag: Явления

model: model_tfidf_catboost_ngram_1_1.
true_tag: Явления
pred_tag: Явления

model: model_tfidf_logreg_ngram_1_1.
true_tag: Явления
pred_tag: Явления, Инструменты

model: model_tfidf_logreg_ngram_1_2.
true_tag: Явления
pred_tag: Явления, Инструменты

```

На примерах хорошо видно разницу в результатах работы алгоритмов. Логистическая регрессия на tfidf-векторах
хорошо определяет не только целевые категории, но и смежные к ним, отсюда должно быть большее количество ложноположительных
предсказаний и более низкий Precision. Нейросети более точечны в своих предсказаниях, а потому лучше подстраиваются под имеющиеся данные